---
title: "Data Management Project: Phase 2"
author: "Andr√©s Fiallos & Blandine Ledoux"
format: html
editor: visual
---

# Estimating the effects of connectivity in intra-EU digitally deliverable trade in services

```{r}
library(vroom)
library(eurostat)
library(here)
```

## Data

In this project, we will merge four different datasets. The following lines of code will download and save the necessary datasets to your computer. If the files already exist, they will be loaded.

### International Trade in Services - OECD

The following data set is around 1.11gb, hence it takes sometime to download. Allow it around 5 minutes.

```{r}

source <- "https://sdmx.oecd.org/public/rest/data/OECD.SDD.TPS,DSD_BOP@DF_TIS,1.0?format=csv"
local_name <- "trade_data.csv"
local_dir <- "raw_data"
## Check if the directory exists, otherwise create
if (!dir.exists(here(local_dir))) {
  ## create the directory if needed
  dir.create(here(local_dir)) 
}
## Check if file exists, otherwise download 
if (!file.exists(here(local_dir, local_name))) {
  ## we need to download it
  trade_data <- vroom(source)
  ## let's save the file to avoid useless downloading
  vroom_write(trade_data, here(local_dir, local_name), delim = ",")
} else {
  ## we need only to load it
  trade_data <- vroom(here(local_dir, local_name))
}

```

### Annual GDP - Eurostat

```{r}
source <- "tec00001"
local_name <- "gdp_eu.csv"
local_dir <- "raw_data"

## Check if file exists, otherwise download 
if (!file.exists(here(local_dir, local_name))) {
  ## we need to download it
  gdp_eu <- get_eurostat(source, time_format = "num", stringsAsFactors = TRUE)
  
  ## let's save the file to avoid useless downloading
  vroom_write(gdp_eu, here(local_dir, local_name), delim = ",")
} else {
  ## we need only to load it
  gdp_eu <- vroom(here(local_dir, local_name))
}
```

### Internet Coverage - Eurostat

```{r}
source <- "isoc_cbs"
local_name <- "internet_eu.csv"
local_dir <- "raw_data"

## Check if file exists, otherwise download 
if (!file.exists(here(local_dir, local_name))) {
  internet_eu <- get_eurostat(source, time_format = "num", stringsAsFactors = TRUE)
  
  vroom_write(internet_eu, here(local_dir, local_name), delim = ",")
} else {
  internet_eu <- vroom(here(local_dir, local_name))
}
```

### Gravity model - CEPPI

```{r}
local_name <- "gravity_data.csv"
local_dir <- "raw_data"

if (!file.exists(here(local_dir, local_name))) {
  url <- "https://www.cepii.fr/DATA_DOWNLOAD/gravity/data/Gravity_csv_V202211.zip"
  
  download.file(url, destfile = here(local_dir,"Gravity_csv_V202211.zip"))
  unzip(here(local_dir,"Gravity_csv_V202211.zip"), exdir = here(local_dir,"gravity_data"))
  
  csv_files <- list.files(here(local_dir,"gravity_data"), full.names = TRUE)
  print(csv_files)
  
  #We need to read second element
  gravity_data <- vroom(csv_files[2]) 

  vroom_write(gravity_data, here(local_dir, local_name), delim = ",")
  
  unlink(here(local_dir,"Gravity_csv_V202211.zip"), recursive = TRUE)
  unlink(here(local_dir,"gravity_data"), recursive = TRUE)
  
} else {
  gravity_data <- vroom(here(local_dir, local_name))
}
```
